{% extends "layout.html" %}
{% block title %}Schedule | Verdant{% endblock %}

{% block content %}
<h2>Your Planting Schedule</h2>
<h3>Diagram</h3>
<pre>{{ diagram }}</pre>

<h3>Detailed Schedule</h3>
<table border="1" cellpadding="5">
    <tr>
        <th>Crop</th>
        <th>Planting Date</th>
        <th>Watering Instructions</th>
        <th>Weeding Instructions</th>
        <th>Harvest Info</th>
        <th>Weather Note</th>
    </tr>
    {% for s in schedule %}
    <tr>
        <td>{{ s.crop }}</td>
        <td>{{ s.planting_date }}</td>
        <td>{{ s.watering_instructions }}</td>
        <td>{{ s.weeding_instructions }}</td>
        <td>{{ s.harvest_info }}</td>
        <td>{{ s.weather_note }}</td>
    </tr>
    {% endfor %}
</table>
{% if allow_save %}
<button id="saveBtn" class="btn">Save</button>
<button id="deleteBtn" class="btn">Delete</button>
<form id="saveForm" method="POST" action="{{ url_for('save_schedule') }}">
    <input type="hidden" name="name" id="scheduleName">
    <input type="hidden" name="is_favorite" id="scheduleFavorite">
    <textarea name="diagram" style="display:none;">{{ diagram }}</textarea>
    <textarea name="schedule_json" style="display:none;">{{ schedule|tojson }}</textarea>
</form>
<script>
document.getElementById('saveBtn').addEventListener('click', function() {
    const name = prompt('Enter a name for this schedule:');
    if (!name) return;
    const favorite = confirm('Favorite this schedule?');
    document.getElementById('scheduleName').value = name;
    document.getElementById('scheduleFavorite').value = favorite ? '1' : '0';
    document.getElementById('saveForm').submit();
});
document.getElementById('deleteBtn').addEventListener('click', function() {
    window.location.href = "{{ url_for('home') }}";
});
</script>
{% endif %}
{% endblock %}

